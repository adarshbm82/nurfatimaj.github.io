<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Nurfatima Jandarova">

  
  
  
    
  
  <meta name="description" content="Specifying an imputation model is quite difficult, especially in big, complex survey data. This makes model selection an important topic.
And as everything else about multiple imputation, evaluation is also proving itself to be a very frustrating exercise. Thankfully, the book by van Buuren (2018) gives a quick discussion of all information relevant to multiple imputation, including the evaluation design and metrics. Here I am trying to give a quick recap of concepts from the book with a focus on my understanding of practical implementation.">

  
  <link rel="alternate" hreflang="en-us" href="/post/research/mi-evaluation-in-stata/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/research/mi-evaluation-in-stata/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Nurfatima Jandarova">
  <meta property="og:url" content="/post/research/mi-evaluation-in-stata/">
  <meta property="og:title" content="MI Evaluation in Stata | Nurfatima Jandarova">
  <meta property="og:description" content="Specifying an imputation model is quite difficult, especially in big, complex survey data. This makes model selection an important topic.
And as everything else about multiple imputation, evaluation is also proving itself to be a very frustrating exercise. Thankfully, the book by van Buuren (2018) gives a quick discussion of all information relevant to multiple imputation, including the evaluation design and metrics. Here I am trying to give a quick recap of concepts from the book with a focus on my understanding of practical implementation."><meta property="og:image" content="img/map[gravatar:%!s(bool=false) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=false) shape:circle]"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-08-23T20:30:25&#43;06:00">
    
    <meta property="article:modified_time" content="2019-10-17T03:25:33&#43;02:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/research/mi-evaluation-in-stata/"
  },
  "headline": "MI Evaluation in Stata",
  
  "datePublished": "2019-08-23T20:30:25+06:00",
  "dateModified": "2019-10-17T03:25:33+02:00",
  
  "author": {
    "@type": "Person",
    "name": "Nurfatima Jandarova"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Nurfatima Jandarova",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "Specifying an imputation model is quite difficult, especially in big, complex survey data. This makes model selection an important topic.\nAnd as everything else about multiple imputation, evaluation is also proving itself to be a very frustrating exercise. Thankfully, the book by van Buuren (2018) gives a quick discussion of all information relevant to multiple imputation, including the evaluation design and metrics. Here I am trying to give a quick recap of concepts from the book with a focus on my understanding of practical implementation."
}
</script>

  

  


  

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
<script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#2962ff",
          "text": "#fff"
        },
        "button": {
          "background": "#fff",
          "text": "#2962ff"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on my website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "https://cookies.insites.com"
      }
    })});
</script>



  





  <title>MI Evaluation in Stata | Nurfatima Jandarova</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Nurfatima Jandarova</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Nurfatima Jandarova</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Research</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#experience"><span>Experience</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#teaching"><span>Teaching</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Blog</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/files/CV_Nurfatima_Jandarova.pdf"><span>CV</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>MI Evaluation in Stata</h1>

  

  
    



<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Oct 17, 2019
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/research/">research</a>, <a href="/categories/tech-fun/">tech fun</a></span>
  

  
    

  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <p><strong>Specifying an imputation model is quite difficult, especially in big, complex survey data. This makes model selection an important topic.</strong></p>
<p>And as everything else about multiple imputation, evaluation is also proving itself to be a very frustrating exercise. Thankfully, the book by 
<a href="https://stefvanbuuren.name/fimd/" target="_blank" rel="noopener">van Buuren (2018)</a> gives a quick discussion of all information relevant to multiple imputation, including the evaluation design and metrics. Here I am trying to give a quick recap of concepts from the book with a focus on my understanding of practical implementation.</p>
<h1 id="concept-recap">Concept recap</h1>
<h2 id="evaluation-design">Evaluation design</h2>
<p>The book outlines three simulation designs for evaluation:</p>
<ol>
<li>Resample observations from the original sample, estimate and aggregate at the end.</li>
<li>Resample observations, pretend different portions of the data are missing, impute and estimate, aggregate at the end.</li>
<li>Pretend different portions of the data are missing, impute and estimate, aggregate at the end.</li>
</ol>
<p>van Buuren advocates the second design as it addresses both sampling and missing data mechanisms, while first - only sampling, and third - only missing data mechanism. Currenlty, however, I have implemented the third design in a cross-validation setting.</p>
<h2 id="evaluation-metrics">Evaluation metrics</h2>
<ol>
<li>Prediction accuracies: raw bias, percentage bias, root mean squared error.</li>
<li>Inference properties: coverage rate and average width.</li>
</ol>
<p>Some papers on multiple imputation also look at the fraction of missing information.</p>
<h1 id="stata-implementation">Stata implementation</h1>
<p>Stata has a good universe of commands for 
<a href="https://www.stata.com/manuals13/mi.pdf" target="_blank" rel="noopener">multiple imputation</a>. Even though there are no off-the-shelf commands for evaluation, it is quite easy to program using <code>mi estimate</code> command.</p>
<h2 id="data-structure">Data structure</h2>
<p>The working dataset is basically two datasets appended together: British Household Panel Survey (BHPS) and Understanding Society (UKHLS). The main outcome variable is college degree attainment from different types of higher education providers: traditional universities, former polytechnics, and other institutions. Let&rsquo;s call these variables <strong>trad_uni</strong>, <strong>poly</strong>, <strong>non_trad_uni</strong>. The type of university exists in BHPS, but not in UKHLS. The goal is to impute these three variables from BHPS into UKHLS. The main analysis model regresses these college degree variables on intelligence score interacted with year of birth. Intelligence scores on the other hand is available in UKHLS, but wasn&rsquo;t asked in BHPS. Therefore, it is available for some BHPS observations that continued into UKHLS and answered cognitive ability questions.</p>
<p>The dataset is structured such that each imputed variable is added as a new variable (<em>wide</em> setting). I test four models differing in regressors included. There are 100 imputations per model, totalling to 400 imputations for each variable.</p>
<h2 id="statistics-of-interest">Statistics of interest</h2>
<p>Evaluation is always done in comparison to some statistic of interest. Currently, I am using three alternatives</p>
<ul>
<li>sample average of college attainment</li>
<li>coefficient from regression of college degree attainment on intelligence scores</li>
<li>vector of coefficients from a similar regression but with interactions with year of birth of cohorts</li>
</ul>
<p>Given the main analysis model, the third option is a natural statistic of interest; however, it is only available for a subset of BHPS observations. Sample average is a simple statistic that only requires the imputed variable itself, but is not a statistic of interest for this project.</p>
<h2 id="custom-program">Custom program</h2>
<h3 id="defining-a-program">Defining a program</h3>
<p>Instead of typing my Stata commands three times, I have decided to define a custom program. Actually, I started liking Stata&rsquo;s <code>program define</code>, especially because you could specify program&rsquo;s <code>syntax</code> making the use of the program much easier in the future.</p>
<pre><code class="language-stata" data-lang="stata">program define cv_eval_fold
	syntax varlist(fv) [if] [in] [fw pw aw iw], maxs(integer) cur_fold(integer) fold_var(varname fv) [main_indepvars(varlist fv) suffix(string)]

	...
	
end
</code></pre><p>Syntax explained:</p>
<ul>
<li><code>cv_eval_fold</code> accepts a varlist (allowing factor variables), sample restrictions through <code>if</code> and <code>in</code> conditions, and all types of weights.</li>
<li>It also accpets required options
<ul>
<li><code>maxs</code> for number of imputation models,</li>
<li><code>cur_fold</code> for the number of the current fold (the fold that is pretended to have missing observations),</li>
<li><code>fold_var</code> for the name of the variable that maps each observation to a fold number.</li>
</ul>
</li>
<li>There are two optional options
<ul>
<li><code>main_indepvars</code> for the main regressors whose coefficients are the &ldquo;statistics of interest&rdquo;,</li>
<li><code>suffix</code> for an abbrevation of statistic of interest.</li>
</ul>
</li>
</ul>
<p>Some &ldquo;hard-learned&rdquo; lessons:</p>
<ul>
<li><code>syntax</code> cannot accept a specification <code>depvar indepvars</code> instead of <code>varlist</code>. But you can easily separate <code>varlist</code> into <code>depvar</code> and <code>indepvars</code> using this command: <code>gettoken depvar indepvars : varlist</code>.</li>
<li>Proper way to implement sample restrictions from syntax is to <code>marksample touse</code> to flag included observations and then pass it to other commands in the following way: <code>reg `depvar' `indepvars' if `touse'</code>;</li>
<li>Required numerical options do not accept default values. So, instead of specifying <del><code>maxs(integer 1)</code></del>, you should write <code>maxs(integer)</code>.</li>
</ul>
<h3 id="true-statistic">&ldquo;True&rdquo; statistic</h3>
<p>Getting a &ldquo;true statistic of interest&rdquo;, i.e. the one with full information from training sample is easy. It is just coefficients from</p>
<pre><code class="language-stata" data-lang="stata">reg `depvar' `main_indepvars' `indepvars' if `touse' [`weight' `exp']
</code></pre><h3 id="estimated-statistic">Estimated statistic</h3>
<p>There is no need to manually run regressions using each imputation and then combining the estimates using Rubins&rsquo; rules. We can just use Stata&rsquo;s <code>mi estimate</code> command, which already outputs the combined results.</p>
<pre><code class="language-stata" data-lang="stata">mi estimate, post imputations(`start'/`end'): reg `depvar'_`cur_fold' `main_indepvars' `indepvars'  if `touse' [`weight' `exp']
</code></pre>
    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/multiple-imputation/">multiple imputation</a>
  
  <a class="badge badge-light" href="/tags/stata-programming/">stata programming</a>
  
  <a class="badge badge-light" href="/tags/evaluation/">evaluation</a>
  
  <a class="badge badge-light" href="/tags/cross-validation/">cross-validation</a>
  
</div>














  
  





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hub78a8f85c0b4d7dc9a60fdc4c2478904_630585_270x270_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Nurfatima Jandarova</a></h5>
      <h6 class="card-subtitle">PhD Candidate</h6>
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:Nurfatima.Jandarova%20[at]%20EUI.eu" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://orcid.org/0000-0002-2732-1029" target="_blank" rel="noopener">
        <i class="ai ai-orcid"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="/files/CV_Nurfatima_Jandarova.pdf" >
        <i class="ai ai-cv"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>












  
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZ1pQbrJr3AKBgupV-V4zLOyQz5rAkM6g"></script>
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/gmaps.js/0.4.25/gmaps.min.js" integrity="sha256-7vjlAeb8OaTrCXZkCNun9djzuB2owUsaO72kXaFDBJs=" crossorigin="anonymous"></script>
      
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.c816d323c3a55093dae0829b44ea1ca8.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
